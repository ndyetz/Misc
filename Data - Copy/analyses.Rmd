---
title: "Lone Star Governance Survey Key Findings"
author: "07/16/2019"
output:
  html_document:
    df_print: paged
    number_sections: yes
    theme: cerulean
    toc: yes
    toc_depth: 3
    toc_float: yes
  html_notebook:
    theme: yeti
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

<style type="text/css">
.main-container {
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}
</style>
    
```{r set-options, echo=FALSE, cache=FALSE}


#
#options(width = 400)
```


#Introduction
This document lays out some key findings from a survey that was distributed to Texas school districts School Board Members and Superintendents that particpated in the [Lone Star Governance (LSG)](https://tea.texas.gov/lsg/) 2-day workshop training. The first response was record on 06/03/2019, and the most recent response was recorded on 06/24/2019.


#Key findings
* [<b><span style="color:darkblue">Survey Responses</b>](#sec3)<font size="3"><span style="color:red">*</span></font>
    + [<span style="color:darkblue">Final N = 129 responses](#sec3)
    + [<span style="color:darkblue">105 School Board Member responses](#sec3)
    + [<span style="color:darkblue">24 Superintendent responses](#sec3)
<br><br>
* [<b><span style="color:darkblue">School Board Member (SBM) results (N = 105)</b>](#sec4)
    + [<span style="color:darkblue">Most SBMs have 3-9 years of experience in that role](#sec4.1)<font size="3"><span style="color:red">*</span></font>
    + [<span style="color:darkblue">SBMs agree that School admins & LEA admins provide the most input to the school regarding the development of goals or vision, Community members and students provide the least](#sec4.2)<font size="3"><span style="color:red">*</span></font>
    + [<span style="color:darkblue">Districts seem to agree that the board provides honest and respectful discussion](#sec4.3)
    + [<span style="color:darkblue">Most districts are monitoring student outcomes on a quarterly - monthly basis](#sec4.4)
    + [<span style="color:darkblue">Most respondents agree that the relationship between the Board and superintendent is collaborative to accomplish student outcome goals, but do not feel it is appropriate to Board members to give instruction to staff members](#sec4.5)
    + [<span style="color:darkblue">Opinions of the LSG workshop were great! most resondents seem to think that the LSG workshop really helped and was engaging!](#sec4.6)
<br><br>
*  [<b><span style="color:darkblue">Superintendent results (N = 24)</b>](#sec5)
    + [<span style="color:darkblue">Most Superintendents have 3-9 years of experience in that role](#sec5.1)<font size="3"><span style="color:red">*</span></font>
    + [<span style="color:darkblue">Superintendents agree that school admins & LEA admins provide the most input to the school regarding the development of goals or vision, Community members and students provide the least](#sec5.2)<font size="3"><span style="color:red">*</span></font>
    + [<span style="color:darkblue">Superintendents have lower agreeance of the respectfulness and honesty in Board meetings](#sec5.3)
    + [<span style="color:darkblue">Superintendent responses indicate that they are monitoring student outcomes on a quarterly - monthly basis](#sec5.4)
    + [<span style="color:darkblue">Most respondents agree that the relationship between the Board and superintendent is collaborative to accomplish student outcome goals, but do not feel it is appropriate to Board members to give instruction to staff members](#sec5.5)
    + [<span style="color:darkblue">Superintendent opinions of the LSG workshop were great!](#sec5.6)
<br><br>
*  [<b><span style="color:darkblue">Comparison results: School board members vs. Superintendents</b>](#secnew)<font size="3"><span style="color:red">*</span></font>
    + [<span style="color:darkblue">Superintendents perceive students have more than their SBM counterpart](#secnew.2)
    + [<span style="color:darkblue">Superintendents perceive school school board discussions to be slightly less honest and respectful than SBM](#secnew.3)
    + [<span style="color:darkblue">Both parties agree that the school board are monitoring student outcomes on a quarterly - monthly basis](#secnew.4)
    + [<span style="color:darkblue">Superintendents slightly disagree that they are given the authority to accomplish student visions and goals](#secnew.5)
    + [<span style="color:darkblue">Both role types had great opinions of the LSG workshop!](#secnew.6)
<br><br>
*  [<b><span style="color:darkblue">Goal & Vision development results (Superintendents & SBMs)</b>](#sec6)<font size="3"><span style="color:red">*</span></font>
    + [<span style="color:darkblue">94% of respondents indicate their school board has a vision for LEA](#sec6.1)
    + [<span style="color:darkblue">97% of respondents indicate their school board has goals related to student outcomes](#sec6.2)
    + [<span style="color:darkblue">Click here to see some of the goals that have been developed](#sec6.2.1)

<font size="3"><span style="color:red">*</span></font> = To be discussed in meeting.
```{r, echo = FALSE}
#Clear Environment
rm(list=ls())
```


```{r, message=FALSE, warning = FALSE, echo= FALSE}
#Load libraries
library(tidyverse)
library(psych    )
library(ggplot2)
library(plotly)
library(data.table)
library(DT)
```



```{r, message = FALSE, echo = FALSE, warning = FALSE}
#Survey Monkey creates terrible datasets. I will be importing my own custom list of variable names. 

#Read in data Don't include first two rows

#codebook
varnames <- read_csv("varnames.csv") 

#column names (first column of codebook)
col_name <- varnames %>% 
  select(varname) %>% 
  as.matrix()           #needs to be a character vector.


#load survey, skip first 2 lines, input codebook column names.
survey   <- read_csv("LSG Survey Data.csv", skip = 2, col_names = col_name) #Skip first two columns and add in new variable names (See varnames dataset to match varname to question text)

#District names to match
districts <- read_csv("districtmatch.csv")

rm(col_name)

```


```{r, echo = FALSE}

#varnames

```


```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Reverse code function - Likert: Min = 1, Max = 4.
reverse_4 <- function(x){(5-x)} 
```


```{r, echo = FALSE, warning = FALSE, message = FALSE}


survey <- survey %>% 
 mutate_if(is.character, as.factor) %>% 
 mutate(`Respondent ID` = as.character(`Respondent ID`)) #coerce ID into character (So we can't math it all up)

tops <- survey %>% 
  select(`Respondent ID`, starts_with("topics_")) #topics = Have meeting frequency responses


tops <- tops %>% 
  mutate_if(
            is.factor, factor, 
            levels = c("In every meeting", "In most meetings", "In a few meetings", "In no meetings"), #Making sure levels are set correctly
            labels = c(1,2,3,4)
            ) %>% 
#  dplyr::na_if(99) %>%                      #99 = NA.
  mutate_if(is.factor, as.numeric) %>%       #Turn all into numeric before I reverse score
  mutate_if(is.numeric, reverse_4) #%>%      #Reverse score (refer to previously created "reverse_agrees" function)
 # mutate_if(
 #           is.numeric, factor, 
 #           levels = c(4,3,2,1),
 #           labels = c("In every meeting", "In most meetings", "In a few meetings", "In no meetings") #Making sure levels are set correctly
 #           )



############4 = strongly agree, 3 = Agree, 2 = Disagree, 1 = Strongly disagree.################

#Merge agree items back into survey
survey <- survey %>% 
  select(-starts_with("topics_")) %>%                    #Remove old ones first
  left_join(tops, by = "Respondent ID")                  #Join in the new ones.
  
```


```{r, echo = FALSE, warning = FALSE, message = FALSE}

survey <- survey %>% 
 mutate_if(is.character, as.factor) %>% 
 mutate(`Respondent ID` = as.character(`Respondent ID`)) #coerce ID into character (So we can't math it all up)

agrees <- survey %>% 
  select(`Respondent ID`, starts_with("agree_"), starts_with("proc_")) #"agrees_" and "proc_" variables are all agree likert items.



agrees <- agrees %>% 
  mutate_if(
            is.factor, factor, 
            levels = c("Strongly Agree", "Agree", "Disagree", "Strongly Disagree", "Not Applicable"), #Making sure levels are set correctly
            labels = c(1,2,3,4, 99)
            ) %>% 
  dplyr::na_if(99) %>%                        #99 = NA.
  mutate_if(is.factor, as.numeric) %>%        #Turn all into numeric before I reverse score
  mutate_if(is.numeric, reverse_4) %>%        #Reverse score (refer to previously created "reverse_agrees" function)
  mutate(proc_prior = 5 - proc_prior) #%>%    #I am reversing this back because it is worded negatively... so higher values = better 
  #select(-proc_prior)                        #Removing the original
############4 = strongly agree, 3 = Agree, 2 = Disagree, 1 = Strongly disagree.################



#Merge agree items back into survey
survey <- survey %>% 
  select(-starts_with("agree_"), -starts_with("proc_")) %>% #Remove old ones first
  left_join(agrees, by = "Respondent ID")                   #Join in the new ones.

```


```{r, echo= FALSE, warning = FALSE, message = FALSE}
stak <- survey %>% 
  select(`Respondent ID`, starts_with("stak")) #"agrees_" and "proc_" variables are all agree likert items.



stak <- stak %>% 
  mutate_if(
            is.factor, factor, 
            levels = c("No Input", "Limited Input", "Moderate Input", "Substantial Input"), #Making sure levels are set correctly
            labels = c(1,2,3,4)
            ) %>% 
  #dplyr::na_if(99) %>%                        #99 = NA.
  mutate_if(is.factor, as.numeric) #%>%        #Turn all into numeric before I reverse score
#  mutate_if(is.numeric, reverse_4)            #Reverse score (refer to previously created "reverse_agrees" function)


survey <- survey %>% 
  select(-starts_with("stak")) %>%          #Remove old ones first
  left_join(stak, by = "Respondent ID")     #Join in the new ones.

```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
engage <- survey %>% 
  select(`Respondent ID`, starts_with("engage")) #"agrees_" and "proc_" variables are all agree likert items.


engage <- engage %>% 
  mutate_if(
            is.factor, factor, 
            levels = c("Annually", "Bi-Annually", "Quarterly", "Monthly", "Don't Know"), #Making sure levels are set correctly
            labels = c(4,3,2,1, 99)
            ) %>% 
  dplyr::na_if(99) %>%                      #99 = NA.
  mutate_if(is.factor, as.numeric)

############4 = ""In every meeting",, 3 = "In most meetings", 2 = "In a few meetings", 1 = "In no meetings" ################



survey <- survey %>% 
  select(-starts_with("engage")) %>%          #Remove old ones first
  left_join(engage, by = "Respondent ID")     #Join in the new ones.
```

```{r, echo= FALSE, results= FALSE, warning = FALSE, message = FALSE}
#
#survey %>% 
#  select(starts_with("agree_"), starts_with("proc_")) %>% 
#  describe()
#
#
#survey %>% 
#  select(role, starts_with("agree_")) %>% 
#  filter(!is.na(role)) %>% 
#  group_by(role) %>% 
#  summarize_all(list(mean = mean), na.rm = TRUE)


```



```{r, echo = FALSE, warning = FALSE, message = FALSE}
#View the data - has text
#survey %>% select(years)

#Need to remove:
  #years, year, yr, months,  month

survey <- survey %>% 
  mutate(
         years = str_remove_all(years, "years" ), #Needs to come before "year"
         years = str_remove_all(years, "year"  ),
         years = str_remove_all(years, "yr"    ),
         years = str_remove_all(years, "months"), #Needs to come before "month"
         years = str_remove_all(years, "month" ),
         
      #Custom removals
         
         years = ifelse(years           == "(2) Two"       , 2, years),
         years = ifelse(years           == "Five"          , 5, years),
         years = ifelse(years           == "Less than a ." , 0, years),
         years = ifelse(years           == "2 1/2"         , 2, years),
         years = ifelse(years           == "Three"         , 3, years),
      
         years = ifelse(`Respondent ID` == 10805885576     , 7, years), #Could not for the life of me match the actual string,therefore removing based on respondent id
         years = ifelse(`Respondent ID` == 10776737747     , 3, years), #Could not for the life of me match the actual string,therefore removing based on respondent id
         years = ifelse(`Respondent ID` == 10814328256     , 5, years), #Could not for the life of me match the actual string,therefore removing based on respondent id
      
      #Convert to numeric, round, and to dbl class (tidyverse's as.numeric equivalant)
         
         years = as.double(years),
         years = round(years, 0)
      )

```


```{r, echo = FALSE}
#Format Class size


survey <- survey %>% 
  mutate(board_meets = str_remove_all(board_meets, "More than " ),
         board_meets = as.numeric(board_meets),
         
         bin_board_meets = ifelse(board_meets < 8, "Less than 8 times", NA),
         bin_board_meets = ifelse(board_meets > 7 & board_meets < 12, "8 - 11 times", bin_board_meets),
         bin_board_meets = ifelse(board_meets > 11, "12 or more times", bin_board_meets),
         bin_board_meets = ifelse(is.na(board_meets), "No response", bin_board_meets),
         bin_board_meets = factor(bin_board_meets,
                                  levels = c("Less than 8 times",
                                             "8 - 11 times",
                                             "12 or more times",
                                             "No response")
                                  )
         )

```



#Survey Response descriptives {#sec3} 
##Applicable responses
```{r, echo = FALSE, warning = FALSE, message = FALSE}

app_responses <- survey %>% 
  select(consent, role) %>% 
  filter(consent == "Yes, I agree to participate.", !is.na(role)) %>% 
  mutate(count = 1) %>% 
  summarize(N = sum(count)) %>% 
  mutate(`Type of Response` = "Answered at least 1 item on survey")

non_consent <- survey %>% 
  select(consent, role) %>% 
  filter(consent != "Yes, I agree to participate.") %>% 
  mutate(count = 1) %>% 
  summarize(N = sum(count)) %>% 
  mutate(`Type of Response` = "Did not consent to survey")

no_fill <- survey %>% 
  select(consent, role) %>% 
  filter(consent == "Yes, I agree to participate.", is.na(role)) %>% 
  mutate(count = 1) %>% 
  summarize(N = sum(count)) %>% 
  mutate(`Type of Response` = "Consented, but did not fill out survey")

nothing <- survey %>% 
  select(consent, role) %>% 
  filter(is.na(consent)) %>% 
  mutate(count = 1) %>% 
  summarize(N = sum(count)) %>% 
  mutate(`Type of Response` = "Opened survey, but did not respond")


response_type <- bind_rows(app_responses, non_consent, no_fill, nothing)




p1 <- ggplot(data = response_type, aes(x = `Type of Response`, y = N, fill = `Type of Response`)) +
  geom_bar(stat = "identity") +
  ggtitle("Types of survey response (N = 143)")+
  ylab("Number of responses") +
  scale_y_continuous(breaks=seq(0, 130, 10), expand = expand_scale(mult = c(0, .01))) +
  theme_light() +
  theme(axis.title.x=element_blank(), 
         axis.text.x=element_blank()#,
         #axis.ticks.x=element_blank()
        )

ggplotly(p1)



```

<br>
<font size="6"><span style="color:blue"> `r paste(app_responses$N)` applicable responses to the LSG survey </span></font>
<br>

There are `r paste(nrow(survey))` survey respondent(s) in the dataset. `r paste(no_fill$N)` respondent(s) consented, but did not fill out the survey. `r paste(non_consent$N)` respondent(s) did not consent to the survey. `r paste(nothing$N)` respondent(s) opened the survey, but did not fill out any portion. Therefore, there were a total of `r paste(app_responses$N)` applicable responses to the LSG survey.
<br>
<br>
**Please note that, of these 129 respondents, 24% of respondents completed <span style="color:red">less than half of the survey</span>**
```{r, echo = FALSE, warning = FALSE, message = FALSE}

responses <- survey %>% 
   filter(consent == "Yes, I agree to participate.", !is.na(role)) %>% 
   select(8:12, 23:47)
  
  
n_na <- enframe(1 - rowSums(is.na(responses)/ncol(responses)))

n_na <- n_na %>% 
  mutate(`% of survey completed` = ifelse(value < .50, '<span style="color:red"><b>Less than 50% completed</b></span>', '<span style="color:green"><b> At least 50% completed </b></span>')) %>% 
  group_by(`% of survey completed`) %>% 
  summarize(N = n())



n_na %>% 
  DT::datatable(escape = FALSE, options = list(columnDefs = list(list(className = 'dt-left', targets = "_all"))))

```

###Districts without survey responses

<br>
<font size="6"> **The following districts did not provide any responses to the survey:** </font> 
<br>
<br>
```{r, warning = FALSE, message = FALSE, echo = FALSE}



survey <- survey %>% 
  filter(consent == "Yes, I agree to participate.") %>% 
  left_join(districts, by = "Collector_ID") 

distinct_dists <- tibble::enframe(unique(survey$Collector_ID))
distinct_dists <- distinct_dists %>% 
  select(Collector_ID = "value", everything()) %>% 
  right_join(districts, by = "Collector_ID") %>% 
  filter(is.na(name))


distinct_dists %>% 
  arrange(Title) %>% 
  mutate(Title = ifelse(Title == "Southwest ISD"  , "Southwest ISD (<b><i>Note: Responded to survey, but did not consent</i></b>)", Title),
         Title = ifelse(Title == "Nacogdoches ISD", "Nacogdoches ISD (<b><i>Note: Responded to survey, but did not consent</i></b>)", Title)) %>% 
  select(`Districts with no survey responses` = "Title") %>% 
  DT::datatable(options = list(pageLength = nrow(distinct_dists)), escape = FALSE)


  
#Southwest ISD	  <- #No response	
#Nacogdoches ISD	<- No responses		

  

```





##Respondents by Role Type

```{r, echo = FALSE,, warning = FALSE, message = FALSE}


role_resp <- survey %>% 
  select(consent, `Number of responses by role` = "role") %>% 
  filter(consent == "Yes, I agree to participate.", !is.na(`Number of responses by role`)) %>% 
  group_by(`Number of responses by role`) %>% 
  mutate(count = 1) %>% 
  summarize(N = sum(count))

role_resp %>% 
  DT::datatable(options = list(pageLength = nrow(role_resp),
                              columnDefs = list(list(className = 'dt-left', targets = "_all"))
                               ), escape = FALSE, rownames = FALSE)

```

#School Board member results {#sec4}
##Descriptives
###Experience in role {#sec4.1}
<blockquote> <font size="6"> ***In total, how many years have you served in this role for this LEA?*** </font> </blockquote>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
Bin_years <- survey %>% 
  filter(consent == "Yes, I agree to participate.", role == "School Board Member") %>% 
  mutate(`years of exp` = ifelse(years < 3, "Less than 3 years experience", NA),
         `years of exp` = ifelse(years > 2 & years < 10, "3- 9 years experience", `years of exp`),
         `years of exp` = ifelse(years > 9 & years < 21, "10 - 20 years experience", `years of exp`),
         `years of exp` = ifelse(years > 20, "21+ years experience", `years of exp`),
         `years of exp` = ifelse(is.na(years), "No response", `years of exp`),
         
         `years of exp` = factor(`years of exp`,
                            levels = c("Less than 3 years experience", 
                                      "3- 9 years experience",
                                      "10 - 20 years experience",
                                      "21+ years experience",
                                      "No response")
                            )
         )

year_sum <- Bin_years %>% 
  group_by(`years of exp`) %>% 
  summarize(N = n())




p1 <- ggplot(data = year_sum, aes(x = `years of exp`, y = N, fill = `years of exp`)) +
  geom_bar(stat = "identity") +
  ggtitle("Responses by years of School Board Member experience (N = 105)", subtitle = "Years of experience categories derived from Dept. of Education categories")+
  ylab("Number of responses") +
  scale_y_continuous(breaks=seq(0, 60, 5), expand = expand_scale(mult = c(0, .1))) +
  theme_light() +
  theme(axis.title.x=element_blank(), 
        axis.text.x=element_blank()#, 
        #panel.grid = element_blank(), 
        #panel.border = element_blank() #,
        # axis.ticks.x=element_blank()
        ) +
  scale_fill_manual("Years of experience", values = c(
                                                       "Less than 3 years experience" = "#00cdcd", 
                                                       "3- 9 years experience"        = "#009a9a", 
                                                       "10 - 20 years experience"     = "#008080", 
                                                       "21+ years experience"         = "#004d4d", 
                                                       "No response" = "grey"
                                                       )
                    ) 


ggplotly(p1)

```


###School board meetings attended
<blockquote> <font size="6"> ***How many school board meetings have you attended during the 2018-19 school year (including only full school board meetings that are open to the public)?*** </font></blockquote>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
meet_sum <- survey %>% 
  filter(consent == "Yes, I agree to participate.", role == "School Board Member") %>% 
  group_by(bin_board_meets) %>% 
  summarize(N = n()) %>% 
  rename(`# of Times attended board meeting` = "bin_board_meets")




p1 <- ggplot(data = meet_sum, aes(x = `# of Times attended board meeting`, y = N, fill = `# of Times attended board meeting`)) +
  geom_bar(stat = "identity") +
  ggtitle("Responses by # of times attended a school board meeting (N = 105)")+
  ylab("Number of responses") +
  scale_y_continuous(breaks=seq(0, 100, 10), expand = expand_scale(mult = c(0, .1))) +
  theme_light() +
  theme(axis.title.x=element_blank(), 
        axis.text.x=element_blank()#, 
        #panel.grid = element_blank(), 
        #panel.border = element_blank() #,
        # axis.ticks.x=element_blank()
        ) +
  scale_fill_manual("Meetings attended", values = c(
                                                     "Less than 8 times" = "#00cdcd", 
                                                     "8 - 11 times"      = "#008080", 
                                                     "12 or more times"  = "#004d4d", 
                                                     "No response"       = "grey"
                                                     )
                    ) 


ggplotly(p1)
```


```{r, echo = FALSE, warning = FALSE, message = FALSE}
#Set Table colors
clrs <- round(seq(100, 250, length.out = length(c(0,1,2,3,4)) + 1), 0) %>%
{paste0("rgb(100,", ., ",", ., ")")}
```


##Extent to which stakeholders provide input {#sec4.2}

<br>
<blockquote> <font size="6"> ***In 2018-19, to what extent have the following groups of stakeholders provided input to the school board regarding development of goals or vision?***</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("stak")) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("stak")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("stak")) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "stak" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "stak") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>% #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2) #Make sure only two digits desplay

#This is really all asthetic. I don't want the # of responses to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 

resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())

smb1 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = FALSE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = No input, 2 = Limited input, 3 = Moderate input, 4 = Substantial input')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>%  
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))


```
<br>
<br>

### Other response answers
```{r, echo = FALSE, warning = FALSE, message = FALSE}

survey %>% 
  filter(role == "School Board Member") %>% 
  select(District = "Title", Oth_stak_goals_TEXT) %>% 
  filter(!is.na(Oth_stak_goals_TEXT)) %>% 
  arrange(District) %>% 
  rename(`Other stakeholders indicated from survey` = "Oth_stak_goals_TEXT") %>% 
  DT::datatable(options = list(pageLength = 5), escape = FALSE, rownames = TRUE)

```


##Opinions of school board meetings {#sec4.3}


<br>
<blockquote> <font size="6"> **To what extent do you agree with or disagree with the following statements regarding school board discussions?**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, agree_hondisc, agree_resp, agree_partic) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(c("agree_hondisc", "agree_resp", "agree_partic") , as.numeric)


overall_mean <- means %>%
  summarize(agree_hondisc = mean(agree_hondisc, na.rm = TRUE),
            agree_resp    = mean(agree_resp   , na.rm = TRUE),
            agree_partic  = mean(agree_partic , na.rm = TRUE)
            ) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, agree_hondisc, agree_resp, agree_partic) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "agree") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>%                            #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)                      #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of responses to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))






#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District,  everything())

smb2 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = TRUE, 
                              scrollY = FALSE, 
                              fixedColumns = TRUE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="350px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly disagree, 2 = Disagree, 3 = Agree, 4 = Strongly agree')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))


```

*Note: Gray cells represent lower agreeance with the items (columns). The responses are separated by district (rows)*



##Engagement in activities {#sec4.4}

<br>
<blockquote> <font size="6"> **How often does your school board engage in the following monitoring activities?**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("engage")) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("engage")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("engage")) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "engage") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>%                            #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)                      #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of responses to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))





#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())

smb3 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = FALSE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = TRUE, 
                              scrollY = FALSE, 
                              fixedColumns = TRUE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="350px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Meet annually, 2 = Bi-Annually, 3 = Quarterly, 4 = monthly ')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))


```


##Opinions of LSG workshop effectiveness {#sec4.5}


<br>
<blockquote><font size="6"> **To what extent do you agree or disagree with the following statements about operating procedures of the school board and superintendent**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("proc")) %>% 
  #rename(proc_prior = "proc_priorR")
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("proc")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("proc")) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "proc") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>%                           #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)                     #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of responses to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))


#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())


smb4 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly Disagree, 4 = Strongly Agree; Note: Item "g" has been reverse coded (4 = Strongly diagree, 1 = Strongly Agree)')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))

```



##Opinion of LSG workshop {#sec4.6}

<br>
<blockquote><font size="6"> **To what extent do you agree or disagree with the following statements regarding LSG**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("agree"), -agree_hondisc, -agree_resp, -agree_partic) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("agree")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "School Board Member") %>% 
  select(Title, starts_with("agree"), -agree_hondisc, -agree_resp, -agree_partic) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "agree") == TRUE & varname != "agree_hondisc" & varname != "agree_resp" & varname != "agree_partic") %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>%                           #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)                     #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of response(s) to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))





#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())


smb5 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = FALSE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly Disagree, 2 = Disagree, 3 = Agree, 4 = Strongly Agree')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))

```






#Superintendent results {#sec5}
```{r, echo = FALSE,, warning = FALSE, message = FALSE}
#SI colors
clrs <- round(seq(255, 10, length.out = length(c(0,1,2,3,4) )+ 1), 0) %>%
{paste0("rgb(255,", ., ",", ., ")")}
```

##Descriptives
###Experience in role
<blockquote><font size="6"> ***In total, how many years have you served in this role for this LEA?*** </font></blockquote>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
Bin_years <- survey %>% 
  filter(consent == "Yes, I agree to participate.", role == "Superintendent") %>% 
  mutate(`years of exp` = ifelse(years < 3, "Less than 3 years experience", NA),
         `years of exp` = ifelse(years > 2 & years < 10, "3 - 9 years experience", `years of exp`),
         `years of exp` = ifelse(years > 9 & years < 21, "10 - 20 years experience", `years of exp`),
         `years of exp` = ifelse(years > 20, "21+ years experience", `years of exp`),
         `years of exp` = ifelse(is.na(years), "No response", `years of exp`),
         
         `years of exp` = factor(`years of exp`,
                            levels = c("Less than 3 years experience", 
                                      "3 - 9 years experience",
                                      "10 - 20 years experience",
                                      "21+ years experience",
                                      "No response")
                            )
         )

year_sum <- Bin_years %>% 
  group_by(`years of exp`) %>% 
  summarize(N = n()) %>% 
  add_row(`years of exp` = "10 - 20 years experience", N = 0, .before = 3) %>% 
  add_row(`years of exp` = "21+ years experience", N = 0, .after = 3 ) %>% 
  mutate( `years of exp` = factor(`years of exp`,
                            levels = c("Less than 3 years experience", 
                                      "3 - 9 years experience",
                                      "10 - 20 years experience",
                                      "21+ years experience",
                                      "No response")
                                  )
          )




p1 <- ggplot(data = year_sum, aes(x = `years of exp`, y = N, fill = `years of exp`)) +
  geom_bar(stat = "identity") +
  ggtitle("Responses by years of Superintendent experience (N = 24)", 
          subtitle = "Years of experience categories derived from Dept. of Education categories") +
  ylab("Number of responses") +
  scale_y_continuous(breaks=seq(0, 15, 5), expand = expand_scale(mult = c(0, .1))) +
  theme_light() +
  theme(axis.title.x=element_blank(), 
        axis.text.x=element_blank()#, 
        #panel.grid = element_blank(), 
        #panel.border = element_blank() #,
        # axis.ticks.x=element_blank()
        ) +
  scale_fill_manual("Years of experience", values = c(
                                                       "Less than 3 years experience" = "#ff0000", 
                                                       "3 - 9 years experience"       = "#bf0000", 
                                                       "10 - 20 years experience"     = "#800000", 
                                                       "21+ years experience"         = "#400000", 
                                                       "No response"                  = "grey"
                                                       )
                    ) 

ggplotly(p1)

```

###School board meetings attended {#sec5.1}
<blockquote><font size="6"> ***How many school board meetings have you attended during the 2018-19 school year (including only full school board meetings that are open to the public)?*** </font></blockquote>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
meet_sum <- survey %>% 
  filter(consent == "Yes, I agree to participate.", role == "Superintendent") %>% 
  group_by(bin_board_meets) %>% 
  summarize(N = n()) %>% 
  rename(`# of Times attended board meeting` = "bin_board_meets") %>% 
  add_row(`# of Times attended board meeting` = "Less than 8 times", N = 0)




p1 <- ggplot(data = meet_sum, aes(x = `# of Times attended board meeting`, y = N, fill = `# of Times attended board meeting`)) +
  geom_bar(stat = "identity") +
  ggtitle("Responses by # of times attended a school board meeting (N = 24)")+
  ylab("Number of responses") +
  scale_y_continuous(breaks=seq(0, 25, 5), expand = expand_scale(mult = c(0, .1))) +
  theme_light() +
  theme(axis.title.x=element_blank(), 
        axis.text.x=element_blank()#, 
        #panel.grid = element_blank(), 
        #panel.border = element_blank() #,
        # axis.ticks.x=element_blank()
        ) +
  scale_fill_manual("Meetings attended", values = c(
                                                    "Less than 8 times" = "#ff0000", 
                                                    "8 - 11 times"      = "#bf0000", 
                                                    "12 or more times"  = "#800000", 
                                                    "No response"       = "grey"
                                                     )
                    ) 


  

ggplotly(p1)
```


##Extent to which stakeholders provide input {#sec5.2}
<br>
<blockquote><font size="6"> ***In 2018-19, to what extent have the following groups of stakeholders provided input to the school board regarding development of goals or vision?***</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("stak")) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("stak")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("stak")) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "stak" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "stak") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>% #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2) #Make sure only two digits desplay

#This is really all asthetic. I don't want the # of responses to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 

resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))





#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())

si1 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = FALSE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = No input, 2= Limited input, 3 = Moderate input, 4 = Substantial input')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))


```
<br>
<br>

### Other response answers
```{r, echo = FALSE, warning = FALSE, message = FALSE}

survey %>% 
  filter(role == "Superintendent") %>% 
  select(District = "Title", Oth_stak_goals_TEXT) %>% 
  filter(!is.na(Oth_stak_goals_TEXT)) %>% 
  arrange(District) %>% 
  rename(`Other stakeholders indicated from survey` = "Oth_stak_goals_TEXT") %>% 
  DT::datatable(options = list(pageLength = 5), escape = FALSE, rownames = TRUE)

```


##Opinions of school board meetings {#sec5.3}


<br>
<blockquote><font size="6"> **To what extent do you agree with or disagree with the following statements regarding school board discussions?**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, agree_hondisc, agree_resp, agree_partic) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(c("agree_hondisc", "agree_resp", "agree_partic") , as.numeric)


overall_mean <- means %>%
  summarize(agree_hondisc = mean(agree_hondisc, na.rm = TRUE),
            agree_resp   = mean(agree_resp  , na.rm = TRUE),
            agree_partic = mean(agree_partic, na.rm = TRUE)
            ) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, agree_hondisc, agree_resp, agree_partic) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "agree") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>% #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)  #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of response(s) to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))





#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())

si2 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = FALSE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = TRUE, 
                              scrollY = FALSE, 
                              fixedColumns = TRUE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="350px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly disagree, 2 = Disagree, 3 = Agree, 4 = Strongly agree')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))


```




##Engagement in activities {#sec5.4}

<br>
<blockquote><font size="6"> **How often does your school board engage in the following monitoring activities?**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("engage")) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("engage")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("engage")) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "engage") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>% #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)  #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of responses to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))





#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())

si3 <- ns %>% 
  filter(District == "Average")

#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = FALSE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = TRUE, 
                              scrollY = FALSE, 
                              fixedColumns = TRUE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="350px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Meet annually, 2 = Bi-Annually, 3 = Quarterly, 4 = monthly ')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))


```

*Note: Gray cells represent lower agreeance with the items (columns). The responses are separated by district (rows)*

##Opinions of LSG workshop effectiveness {#sec5.5}


<br>
<blockquote><font size="6"> **To what extent do you agree or disagree with the following statements about operating procedures of the school board and superintendent**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("proc")) %>% 
  #rename(proc_prior = "proc_priorR")
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("proc")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("proc")) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "proc") == TRUE) %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>% #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)  #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of responses to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))






#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())

si4 <- ns %>% 
  filter(District == "Average")


#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = FALSE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly Disagree, 4 = Strongly Agree; Note: Item "g" has been reverse coded (4 = Strongly diagree, 1 = Strongly Agree)')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))

```



##Opinion of LSG workshop {#sec5.6}

<br>
<blockquote><font size="6"> **To what extent do you agree or disagree with the following statements regarding LSG**</font> </blockquote>
<br><br>

```{r warning = FALSE, message= FALSE, echo = FALSE}


#Summarize to get mean values
means <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("agree"), -agree_hondisc, -agree_resp, -agree_partic) %>% 
  group_by(Title) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  mutate_if(is.numeric, format, nsmall = 2) %>% 
  mutate_at(vars(starts_with("agree")) , as.numeric)


overall_mean <- means %>%
  summarize_at(vars(2:length(means)), mean, na.rm = TRUE) %>% 
  mutate(Title = "Average") %>% 
  select(Title, everything())

means <-   bind_rows(overall_mean, means)

#Filter to just variables I want
ns <- survey %>% 
  filter(role == "Superintendent") %>% 
  select(Title, starts_with("agree"), -agree_hondisc, -agree_resp, -agree_partic) %>% 
  group_by(Title) %>% 
  summarize(n = n())

#round all numeric variable to 2 decimal places
ns <- ns %>% 
  right_join(means, by = "Title") %>% 
  mutate(n = ifelse(is.na(n), sum(n, na.rm = TRUE), n)) %>% 
  mutate_if(is.numeric, round, 2) 

#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

#Grab the names that start with, "agree" from the varnames list. I want to present the item text, rather than the variable names... which is present
agree_names <- varnames %>% 
  filter(str_detect(varname, "agree") == TRUE & varname != "agree_hondisc" & varname != "agree_resp" & varname != "agree_partic") %>% 
  select(varname, Orig_resp) 


#Now merge the agree names into the datset
ns <- ns %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(varname = row.names(ns)) %>% 
  left_join(agree_names, by = "varname") %>% 
  select(`Item text` = "Orig_resp", everything(), -varname) %>% 
  mutate_if(is.numeric, round, 2) %>% #Round everything to 2 digits
  mutate_if(is.numeric, format, nsmall = 2)  #Make sure only two digits desplay




#This is really all asthetic. I don't want the # of response(s) to have two decimal places, so I need to take it out, manipulate it, then put it back in. 
##Also, I know it's weird, but I'm converting things into character variables for presentation. This makes things bind easier and I will be able to make things easier for NaN's
resp_num <- ns %>% 
  filter(is.na(`Item text`)) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate_if(is.numeric, format, nsmall = 0) %>% 
  mutate(`Item text` = ifelse(`Item text` == "NA", "", "")) %>% 
  mutate_if(is.character, as.numeric) %>% 
  mutate(`Item text` = as.character(`Item text`),
         `Item text`= ifelse(is.na(`Item text`), "# of response(s)", "# of response(s)")) 


resp_num[] <- lapply(resp_num, function(x) paste(x, "response(s)", sep=" "))

resp_num <- resp_num %>% 
  mutate(`Item text` = ifelse(`Item text` == "# of response(s) response(s)", "# of response(s)", "# of response(s)"))
  

#Turn everything into character, and prepare to bind back in the response #'s
ns <- ns %>% 
  filter(!is.na(`Item text`)) %>%  
  mutate_if(is.numeric, as.character)

#Bind them
ns <- bind_rows(resp_num, ns)

#Turn any "Nan"'s into "No response
ns <- ns %>% 
  mutate_all(funs(str_replace(., "NaN", "Did not answer")))



#Grab names from (Names get lost in transpose)
this <- names(ns)

#Transpose (Fist column names get lost for some reason I really don't understand why data.table does this.)
ns <- ns %>% 
  transpose() 

#Reintroduce the rownames
rownames(ns) <- this

#The first row should be the column names. Here, I am making that happen
colnames(ns) <- as.character(unlist(ns[1,])) #Put first row into column names
ns = ns[-1, ]                                #Delete first row

ns <- ns %>% 
  mutate(District = rownames(ns)) %>% 
  select(District, everything())

si5 <- ns %>% 
  filter(District == "Average")


#Make a nice, interactive table
ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly Disagree, 2 = Disagree, 3 = Agree, 4 = Strongly Agree')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
  #  formatStyle('Item text', target = 'row', 
  #            backgroundColor = styleEqual(my_vals, my_colors))


```




#Comparisons by Roles {#secnew}
```{r, echo = FALSE, warning = FALSE, message = FALSE}

#SI colors
clrs <- round(seq(100, 200, length.out = length(c(0,1,2,3,4) )+ 1), 0) %>%
{paste0("rgb(100,", ., "55,", ., ")")}
```


##Extent to which stakeholders provide input {#secnew.2}
<br>
<blockquote> <font size="6"> ***In 2018-19, to what extent have the following groups of stakeholders provided input to the school board regarding development of goals or vision?***</font> </blockquote>
<br><br>
```{r, echo = FALSE, warning = FALSE, message = FALSE}


ns <- bind_rows(smb1, si1, .id = "Role")
ns <- ns %>% 
  mutate(Role = ifelse(Role == "1", "School Board Member", "Superintendent")) %>% 
  select(Role, everything(), -District)


ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(#pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = No input, 2 = Limited input, 3 = Moderate input, 4 = Substantial input')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 

```

##Opinions of school board meetings {#secnew.3}
<br>
<blockquote> <font size="6"> **To what extent do you agree with or disagree with the following statements regarding school board discussions?**</font> </blockquote>
<br><br>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
ns <- bind_rows(smb2, si2, .id = "Role")
ns <- ns %>% 
  mutate(Role = ifelse(Role == "1", "School Board Member", "Superintendent")) %>% 
  select(Role, everything(), -District)


ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(#pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly Disagree, 2 = Disagree, 3 = Agree, 4 = Strongly Agree')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
```
##Engagement in activities {#secnew.4}

<br>
<blockquote> <font size="6"> **How often does your school board engage in the following monitoring activities?**</font> </blockquote>
<br><br>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
ns <- bind_rows(smb3, si3, .id = "Role")
ns <- ns %>% 
  mutate(Role = ifelse(Role == "1", "School Board Member", "Superintendent")) %>% 
  select(Role, everything(), -District)

ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(#pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Annually, 2 = Bi-Annually, 3 = Quarterly, 4 = Monthly')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
```

##Opinions of LSG workshop effectiveness {#secnew.5}

<br>
<blockquote><font size="6"> **To what extent do you agree or disagree with the following statements about operating procedures of the school board and superintendent**</font> </blockquote>
<br><br>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
ns <- bind_rows(smb4, si4, .id = "Role")
ns <- ns %>% 
  mutate(Role = ifelse(Role == "1", "School Board Member", "Superintendent")) %>% 
  select(Role, everything(), -District)


ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(#pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly Disagree, 4 = Strongly Agree; Note: Item "g" has been reverse coded (4 = Strongly diagree, 1 = Strongly Agree)')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
```

##Opinion of LSG workshop {#secnew.6}

<br>
<blockquote><font size="6"> **To what extent do you agree or disagree with the following statements regarding LSG**</font> </blockquote>
<br><br>

```{r, echo = FALSE, warning = FALSE, message = FALSE}
ns <- bind_rows(smb5, si5, .id = "Role")
ns <- ns %>% 
  mutate(Role = ifelse(Role == "1", "School Board Member", "Superintendent")) %>% 
  select(Role, everything(), -District)


ns %>% 
 DT::datatable(escape = TRUE, 
               autoHideNavigation = FALSE, 
               fillContainer = FALSE, 
               rownames = FALSE, 
               class = "stripe row-border",
               extensions = c('FixedColumns', 'KeyTable'),
               options = list(#pageLength = 10, 
                              autoWidth = FALSE, 
                              scrollY = FALSE, 
                              scrollX = TRUE,
                              fixedColumns = FALSE, 
                              keys = TRUE,
                                  columnDefs = list(
                                                    list(
                                                         width="300px", 
                                                         className = 'dt-center', 
                                                         targets= "_all"
                                                         )
                                                    )
                                ),
               caption = htmltools::tags$caption(style = 'caption-side: top; text-align: center;','', 
                                                 htmltools::em('1 = Strongly Disagree, 2 = Disagree, 3 = Agree, 4 = Strongly Agree')
                                                 )
               ) %>% 
  formatStyle(names(ns), backgroundColor = styleInterval(c(0,1,2,3,4), clrs)) #%>% 
```


#Goal Development {#sec6}
##School board has a Vision developed {#sec6.1}

<font size="6"> Has your school board developed and adopted a vision for the LEA? </font>

```{r, echo = FALSE, warning = FALSE, message = FALSE}
survey %>% 
  select(`Does your board have a vision?` = "vision") %>% 
  filter(!is.na(`Does your board have a vision?`)) %>% 
  group_by(`Does your board have a vision?`) %>% 
  summarize(N = n()) %>% 
  mutate(`%` = N / (N[1] + N[2]),
         `%` = round(`%`, 2),
         `%` = `%`*100,
         `%` = paste0(`%`, "%")) %>% 
  DT::datatable(escape = FALSE, options = list(columnDefs = list(list(className = 'dt-left', targets = "_all"))))
```

##School board has goals {#sec6.2}

<blockquote><font size="6"> Has your school board adopted goals related to student outcomes that are currently being used? </font></blockquote>
```{r, echo = FALSE, warning = FALSE, message = FALSE}
survey %>% 
  select(`Does your board have goals?` = "goals") %>% 
  filter(!is.na(`Does your board have goals?` )) %>% 
  group_by(`Does your board have goals?` ) %>% 
  summarize(N = n()) %>% 
  mutate(`%` = N / (N[1] + N[2]),
         `%` = round(`%`, 2),
         `%` = `%`*100,
         `%` = paste0(`%`, "%")) %>% 
  DT::datatable(escape = FALSE, options = list(columnDefs = list(list(className = 'dt-left', targets = "_all"))))
```

###Examples of goals {#sec6.2.1}
Are these Goals S.M.A.R.T.?

**S**pecific<br>
**M**easurable<br>
**A**chievable<br> 
**R**elevant<br>
**T**ime-based<br>

<blockquote><font size="6"> In the text boxes below, please provide examples of two of the goals related to student outcomes that the school board has in place for the 2018-19 school year.</font></blockquote>


```{r, echo = FALSE, warning = FALSE, message = FALSE}

goal_1 <- survey %>% 
  select(District = "Title", Goal = "goal_ex_1") %>% 
  filter(!is.na(Goal)) %>% 
  mutate_if(is.factor, as.character)

goal_2 <- survey %>% 
  select(District = "Title", Goal = "goal_ex_2") %>% 
  filter(!is.na(Goal))%>% 
  mutate_if(is.factor, as.character)

Goals <- bind_rows(goal_1, goal_2) 

Goals %>% 
  DT::datatable(escape = FALSE, options = list(columnDefs = list(list(className = 'dt-left', targets = "_all"))))



```


**Strong S.M.A.R.T. Goals**

1.  "The percentage of kindergarten-grade2 students reading on or above grade level will increase from 64% to 90% by year 2023"
2.  "Percentage of students reading on or above grade level will increase from 43% to 70% by August 31, 2021."
3.  "By school year 2020-2021 85% of all 2nd grade students will be reading on grade level"


**Weak S.M.A.R.T. Goals**

1.  "increase reading mastery"
2.  "Higher graduation rate"
3.  "To see improvement In reading"


#Questions?
Please send any questions to Neil Yetz, MPH at <nyetz@air.org>



